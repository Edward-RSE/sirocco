<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anisotropic Scattering &mdash; python 88a documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Atomic Data" href="../atomic.html" />
    <link rel="prev" title="Special Relativity and Co-Moving Frames" href="relativity_comoving.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            python
          </a>
              <div class="version">
                88
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick.html"><em>Quick Guide to Python</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_python.html">Running Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input.html">Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output.html">Outputs &amp; Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting.html">Plotting &amp; Processing Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation.html">Code Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../radiation.html">Radiation Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wind_models.html">Wind Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coordinate.html">Coordinate grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../physics.html">Physics &amp; Radiative Transfer</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="radiative_transfer.html">Radiative Transfer Modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="macroatoms.html">Macro Atoms</a></li>
<li class="toctree-l2"><a class="reference internal" href="relativity_comoving.html">Special Relativity and Co-Moving Frames</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Anisotropic Scattering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../atomic.html">Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../meta.html">Meta-documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../py_progs.html">Python Scripts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../physics.html">Physics &amp; Radiative Transfer</a></li>
      <li class="breadcrumb-item active">Anisotropic Scattering</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/physics/aniso.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="anisotropic-scattering">
<h1>Anisotropic Scattering<a class="headerlink" href="#anisotropic-scattering" title="Permalink to this heading"></a></h1>
<p>Python has a number of radiative transfer modes, controlled via the <a class="reference internal" href="../input/parameters/rt_ion/Line_transfer.html"><span class="doc">Line_transfer</span></a> keyword. Included in this mode is the treatment of line anisotropy; whether re-emission of a line photon is isotropic or not. When the scattering is isotropic, a new direction is simply chosen by choosing a random direction in the co-moving frame of the plasma.</p>
<p>If anisotropic scattering is on, via one of the thermal trapping modes, the new direction is chosen according to a rejection method. The aim is to account for the fact the photon undergoes many interactions in the resonant zone due to the thermal width of the line, and finds it easier to escape along the direction in which the optical depth is lowest (where the velocity gradient is highest). Specifically, the code undergoes the following steps:</p>
<ul class="simple">
<li><p>choose a random number between 0 and 1, <span class="math notranslate nohighlight">\(z\)</span></p></li>
<li><p>choose random direction, <span class="math notranslate nohighlight">\(\hat{n}\)</span></p></li>
<li><p>evalute Sobolev optical depth along this direction, <span class="math notranslate nohighlight">\(\tau_\hat{n}\)</span></p></li>
<li><p>calculate the escape probability along this direction <span class="math notranslate nohighlight">\(P_{\rm esc} (\tau_\hat{n})\)</span>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(P_{\rm esc} \geq z\)</span>, then escape the loop, otherwise increment a counter <code class="docutils literal notranslate"><span class="pre">nnscat</span></code> and proceed to the first step.</p></li>
</ul>
<p>This process is repeated until the loop is exited or 10,000 iterations are reached. The rejection method is trying to sample the volume bounded in <span class="math notranslate nohighlight">\(\theta,\phi\)</span> space by the complicated surface <span class="math notranslate nohighlight">\(P_{\rm esc} (\theta,\phi)\)</span>.</p>
<p>In highly optically thick regions, escape probabilities in all directions can be small, in which case the above rejection method can be extremely inefficient (the volume bounded by <span class="math notranslate nohighlight">\(P_{\rm esc} (\theta,\phi)\)</span> is extremely small). Because of this, the code re-normalises the rejection method by first calculating the escape probability along the maximum velocity gradient, which is the maximum escape probability.</p>
<div class="admonition-developer-note-the-re-normalisation-scheme admonition">
<p class="admonition-title">Developer note: the re-normalisation scheme</p>
<p>Describe.</p>
</div>
<section id="anisotropy-within-the-viewpoint-technique">
<h2>Anisotropy within the viewpoint technique<a class="headerlink" href="#anisotropy-within-the-viewpoint-technique" title="Permalink to this heading"></a></h2>
<p>Within the viewpoint technique (also called extract or the peel-off method), described under <a class="reference internal" href="../operation/spectral_cycles.html"><span class="doc">Spectral Cycles</span></a>, anisotropy has to be accounted for. At each interaction or wind photon generation, the photon packet is forced along a direction <span class="math notranslate nohighlight">\(\theta\)</span>, with its weight  adjusted according to</p>
<div class="math notranslate nohighlight">
\[w_{\rm out}=\frac{P(\theta)}{\langle P (\theta) \rangle} w_{\rm in}.\]</div>
<p>For anisotropic scattering, <span class="math notranslate nohighlight">\(P(\theta) \neq \langle P \rangle\)</span>. To deal with this, we need to calculate the escape probability along the desired direction, given by</p>
<div class="math notranslate nohighlight">
\[P(\theta) = \frac{1 - \exp [-\tau(\theta)]}{\tau(\theta)}\]</div>
<p>where <span class="math notranslate nohighlight">\(\tau(\theta)\)</span> is the Sobolev optical depth in a given direction. This is a local quantity evaluated at the point of resonance. <span class="math notranslate nohighlight">\(\langle P (\theta) \rangle\)</span> is calculated using a by-product of the rejection method. For a rejection method that samples a properly normalised probability space – a probability space that has a (hyper)volume of 1 – the number of iterations in the rejection method, <span class="math notranslate nohighlight">\(N_{\rm it}\)</span> tells us (in this case) about the mean escape probability. More correctly, the expectation value of <span class="math notranslate nohighlight">\(1/N_{\rm it}\)</span> is the mean escape probability. Thus, we multiply by a factor of <span class="math notranslate nohighlight">\(1/N_{\rm it}\)</span> in the code to account for the <span class="math notranslate nohighlight">\(\langle P (\theta) \rangle\)</span> factor in the denominator.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>check the above statement about the expectation value of <span class="math notranslate nohighlight">\(1/N_{\rm it}\)</span> is really true – I think it must be, since it’s basically the definition of a probability. Does <span class="math notranslate nohighlight">\(N_{\rm it}\)</span> also correspond to the actual physical number of scatters?</p>
</div>
<div class="admonition-developer-note admonition">
<p class="admonition-title">Developer note</p>
<p>The above calculation is split up within the code. The factor <span class="math notranslate nohighlight">\(P(\theta)\)</span> is applied in the function <code class="docutils literal notranslate"><span class="pre">extract_one</span></code>, whereas the division by <span class="math notranslate nohighlight">\(\langle P \rangle\)</span> is applied using the variable <code class="docutils literal notranslate"><span class="pre">nnscat</span></code> in extract, which is <span class="math notranslate nohighlight">\(N_{\rm it}\)</span> in the above notation. This is because the mean escape probability is (statistically speaking) equal to <span class="math notranslate nohighlight">\(1/N_{\rm it}\)</span> as described above.</p>
<p>Note, also, that in practice we have to account for the renormalisation of the rejection method, so rather than multiply by <span class="math notranslate nohighlight">\(N_{\rm it}\)</span>, we multiply by <span class="math notranslate nohighlight">\(N_{\rm it}/P_{\rm norm}\)</span> (see pevious developer note).</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="relativity_comoving.html" class="btn btn-neutral float-left" title="Special Relativity and Co-Moving Frames" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../atomic.html" class="btn btn-neutral float-right" title="Atomic Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2024, Knox Long, Christian Knigge, Stuart Sim, Nick Higginbottom, James Matthews, Sam Mangham, Edward Parkinson, Mandy Hewitt, Nicolas Scepi, Austen Wallis, Amin Mosallanezhad.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>