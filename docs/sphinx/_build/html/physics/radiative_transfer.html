<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Radiative Transfer Modes &mdash; python 86g documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Macro Atoms" href="macroatoms.html" />
    <link rel="prev" title="Physics &amp; Radiative Transfer" href="../physics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            python
          </a>
              <div class="version">
                86
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick.html"><em>Quick Guide to Python</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_python.html">Running Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input.html">Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output.html">Outputs &amp; Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting.html">Plotting &amp; Processing Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation.html">Code Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../radiation.html">Radiation Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wind_models.html">Wind Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coordinate.html">Coordinate grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../physics.html">Physics &amp; Radiative Transfer</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Radiative Transfer Modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="macroatoms.html">Macro Atoms</a></li>
<li class="toctree-l2"><a class="reference internal" href="relativity_comoving.html">Special Relativity and Co-Moving Frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="aniso.html">Anisotropic Scattering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../atomic.html">Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../meta.html">Meta-documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../py_progs.html">Python Scripts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../physics.html">Physics &amp; Radiative Transfer</a></li>
      <li class="breadcrumb-item active">Radiative Transfer Modes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/physics/radiative_transfer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="radiative-transfer-modes">
<h1>Radiative Transfer Modes<a class="headerlink" href="#radiative-transfer-modes" title="Permalink to this heading"></a></h1>
<p>Python has a number of different radiative transfer modes, which affect the treatment of lines and scattering, and also whether we use indivisible packet constraints or allow photon weights to be attenuated by continuum absorption. These modes are selected with the parameter <a class="reference internal" href="../input/parameters/rt_ion/Line_transfer.html#line-transfer"><span class="std std-ref">Line_transfer</span></a>. The different modes are briefly described on that parameter page. This page is designed to give an overview of the assumptions and concepts behind, as well as the basic operation of, the different techniques. The aim is that, in partnership with the parameter page and the atomic data documentation, all the information regarding the different radiative transfer modes should be present.</p>
<p>For introductions and references regarding Monte Carlo radiative transfer techniques generally, we recommend reading <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019LRCA....5....1N/abstract">Noebauer &amp; Sim 2019</a>. For specifics regarding Python, we recommend reading <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2002ApJ...579..725L/abstract">Long &amp; Knigge 2002</a> as well as  PhD theses by <a class="reference external" href="https://eprints.soton.ac.uk/368584/1/Higginbottom.pdf">Higginbottom</a> and <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2016PhDT.......348M/abstract">Matthews</a>.</p>
<section id="sobolev-approximation">
<h2>Sobolev Approximation<a class="headerlink" href="#sobolev-approximation" title="Permalink to this heading"></a></h2>
<p>Python always uses the Sobolev approximation to treat line transfer. In this approximation, it is assumed that the thermal line width is small compared to the velocity gradient. The Sobolev approximation is described extensively in astrophysics literature, and so we do not describe it in detail here. We refer the users to section 8.2 of <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019LRCA....5....1N/abstract">Noebauer &amp; Sim 2019</a> and references there in for a discussion of the Sobolev escape probabilities approach.</p>
</section>
<section id="weight-reduction-v-indivisible-packets">
<h2>Weight Reduction v Indivisible Packets<a class="headerlink" href="#weight-reduction-v-indivisible-packets" title="Permalink to this heading"></a></h2>
<p>Python was originally written in such a way that photon packet weights were not indivisible and allowed to be attenuated. This is the way the code is described in the original <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2002ApJ...579..725L/abstract">Long &amp; Knigge 2002</a> paper. In the standard, weight reduction mode, photon weights are attenuated by continuum opacities (free-free, bound-free). Conservation of energy is then hopefully achieved by calculating the emission from the wind .</p>
<p>In indivisible packet mode, there is a fundamental shift in philosophy. All energy packets are strictly indivisible and conserve energy whenever they undergo radiative processes (the only exception is adiabatic cooling). Thus, even bound-free absorption is dealt with at a single interaction point.</p>
<p>Indivisible packet mode is activated by setting the <a class="reference internal" href="../input/parameters/rt_ion/Line_transfer.html#line-transfer"><span class="std std-ref">Line_transfer</span></a> parameter to either <code class="docutils literal notranslate"><span class="pre">macro_atoms</span></code> or <code class="docutils literal notranslate"><span class="pre">macro_atoms_thermal_trapping</span></code>. The terminology adopted here is slightly confusing, since the line transfer mode does not explicitly include a macro-atom treatment of atomic species (see next subsection).</p>
<div class="admonition-developer-note admonition">
<p class="admonition-title">Developer Note</p>
<p>The radiative transfer mode is stored using the code variable geo.rt_mode.</p>
</div>
</section>
<section id="macro-atoms-and-2-level-atoms">
<h2>Macro-atoms and 2-level-atoms<a class="headerlink" href="#macro-atoms-and-2-level-atoms" title="Permalink to this heading"></a></h2>
<p>The macro-atom scheme was devised by Leon Lucy in the early 2000s (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2002A%26A...384..725L/abstract">Lucy 2002</a>, <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2003A%26A...403..261L/abstract">Lucy 2003</a>).
It involves the reformulation of the process of radiation transport through a plasma in radiative equilibrium into a traffic-flow problem. Lucy showed that, when in radiative equilibrium, the energy flows through a system depend only on the transition probabilities and atomic physics associated with the levels the energy flow interacts with. By quantising this energy flow into radiant (r-) and kinetic (k-) packets, we can simulate the energy transport through a plasma discretised into volume elements (<em>macro-atoms</em>), whose associated transition probabilities govern the interaction of radiant and kinetic energy with the ionization and excitation energy associated with the ions of the plasma.</p>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>add refs, describe properly.</p>
</div>
<div class="admonition-developer-note admonition">
<p class="admonition-title">Developer Note</p>
<p>Macro-atoms are identified using their atomic data, in particular by providing data with identifiers
LevMacro, LinMacro, PhotMacro.</p>
</div>
<p>Simple-atoms still interact with r- and k-packets, but do not possess internal transition probabilities. As a result, they are analogous to the two-level atom treatment, as any excitation is immediately followed by a deactivation into an r- or k-packet. The choice of radiative or kinetic deactivation is made according  to the relative rates in the two-level atom formalism.</p>
</section>
<section id="isotropic-v-anisotropic-line-scattering">
<h2>Isotropic v Anisotropic Line Scattering<a class="headerlink" href="#isotropic-v-anisotropic-line-scattering" title="Permalink to this heading"></a></h2>
<p>Python always treats electron scattering as an isotropic process, and continuum emission processes are also treated as isotropic, except for Compton scattering. For Compton scattering, the direction and energy change is calculated self-consistently according to the energy change formula <span class="math notranslate nohighlight">\(E/E'=1+(h \nu/mc^2)(1+\cos\theta)\)</span>. We first draw a random cross section that our photon packet will see. This cross section represents an energy change and hence a direction. The distribution of angles is taken care of by using a differential cross section vs energy change function.</p>
<div class="admonition-caution admonition">
<p class="admonition-title">Caution</p>
<p>Compton scattering is currently not accounted for when using indivisible packet mode.</p>
</div>
<p>Line emission and scattering is isotropic unless one of the  <code class="docutils literal notranslate"><span class="pre">thermal_trapping</span></code> line transfer modes is selected. In the thermal trapping mode, any line interaction or emission results in an anisotropic direction being generated. This direction is generated by a rejection method which samples the Sobolev escape probability in each direction from the line interaction region. Unless you specifically want to consider isotropic line emission, we recommend always using the anisotropic thermal trapping mode.</p>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>move the below to where we describe photon sources and generation?</p>
</div>
<p>In the case of isotropic emission, the direction of a photon packet is chosen so that the probability of emission in each bin of solid angle is the same. It follows that</p>
<div class="math notranslate nohighlight">
\[p(\Omega)d\Omega \propto \cos \theta \sin \theta d\theta d\phi\]</div>
<p>where the angles are in polar coordinates and relative to the local outward normal. For a spherical emitting source, such as a star, one must first generate a location on the star’s surface and then calculate the photon direction relative to the normal at the point. For emission from optically thick surfaces the above equation can be modified to include linear limb darkening, <span class="math notranslate nohighlight">\(\eta(\theta)\)</span>, such that</p>
<div class="math notranslate nohighlight">
\[p(\theta, \phi) d\theta d\phi = \eta(\theta) \cos \theta \sin \theta d\theta d\phi.\]</div>
<p>The Eddington approximation is usually adopted in the code, so that $eta(theta)$
is given by</p>
<div class="math notranslate nohighlight">
\[\eta(\theta) = a (1 - \frac{3}{2} \cos \theta).\]</div>
<p>The constant <span class="math notranslate nohighlight">\(a\)</span> is normalised such that the total probability sums to 1. Whenever a radiation packet undergoes an electron scatter, the new direction is chosen to be isotropic. However, when the photon is a line photon, the new direction is chosen according to a line trapping model, which samples a probability distribution according to the Sobolev escape probability in different directions.</p>
</section>
<section id="doppler-shifts-and-the-comoving-frame">
<h2>Doppler Shifts and The Comoving Frame<a class="headerlink" href="#doppler-shifts-and-the-comoving-frame" title="Permalink to this heading"></a></h2>
<p>When calculating opacities, the photon frequency must be shifted from the rest frame of the photon into the rest frame of the plasma. This shift depends on the before and after directions of the photon. Let us denote these two directions with unit vectors <span class="math notranslate nohighlight">\(\vec{n}_i\)</span> and <span class="math notranslate nohighlight">\(\vec{n}_f\)</span>, respectively, and consider a situation when a photon scatters off an electron in a region of the wind moving at velocity <span class="math notranslate nohighlight">\(\vec{v}\)</span>. The final frequency of the photon with initial frequency is</p>
<div class="math notranslate nohighlight">
\[\nu_f = \nu_i ~\frac{1 - (\vec{v} \cdot \vec{n}_i) / c}{1 - (\vec{v} \cdot \vec{n}_f) / c}.\]</div>
<p>In the case of a resonance scatter with line transition u to j, the new frequency is</p>
<div class="math notranslate nohighlight">
\[\nu_f = \frac{\nu_{uj}}{1 - (\vec{v} \cdot \vec{n}_f) / c}.\]</div>
<p>The above formulae are the non-relativistic case, which is currently used in the code. However, this should in general be improved to use the special relativistic formula. This would produce more accurate Doppler shifts for the fastest regions of an outflow, as the current treatment introduces errors of order 5 Angstroms at the blue edges of the highest velocity absorption lines in quasar and CV wind models.</p>
<p>When real photons resonantly (or electron) scatter off real plasma in a flow, they conserve energy and frequency in the co-moving frame of the plasma. In the case of an outflow, doing the frame transformation from system-&gt;flow-&gt;system over the course of an interaction results in a redshifting of a photon, and as a result an energy loss - in other words, the photon does work on the flow even though energy is conserved in the co-moving frame. Indivisible packet schemes (such as macro-atoms) often enforce strict energy conservation in the frame of a given cell (physically, but see also <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2002A%26A...384..725L/abstract">Lucy 2002</a>). This means that, when keeping track of packets in the observer frame, one needs to correct the energies (not just the frequencies) using a Doppler shift. Python does <strong>not</strong> currently conserve energy in the co-moving frame.</p>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Todo</p>
<p>test whether this is an issue.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../physics.html" class="btn btn-neutral float-left" title="Physics &amp; Radiative Transfer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="macroatoms.html" class="btn btn-neutral float-right" title="Macro Atoms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2023, Knox Long, Christian Knigge, Stuart Sim, Nick Higginbottom, James Matthews, Sam Mangham, Edward Parkinson, Mandy Hewitt.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>