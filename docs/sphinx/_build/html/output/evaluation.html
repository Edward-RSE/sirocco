<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evaluation &mdash; python 86g documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model" href="model.html" />
    <link rel="prev" title="Diagnostic files" href="diagnostics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            python
          </a>
              <div class="version">
                86
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick.html"><em>Quick Guide to Python</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_python.html">Running Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input.html">Inputs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../output.html">Outputs &amp; Evaluation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">Diagnostic files</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html">Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectrum_files.html">Spectra Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectrum_generation_large_optical_depth.html">Issues with Generating Spectra</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plotting.html">Plotting &amp; Processing Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation.html">Code Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../radiation.html">Radiation Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wind_models.html">Wind Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coordinate.html">Coordinate grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics.html">Physics &amp; Radiative Transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../atomic.html">Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../meta.html">Meta-documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../py_progs.html">Python Scripts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../output.html">Outputs &amp; Evaluation</a></li>
      <li class="breadcrumb-item active">Evaluation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/output/evaluation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="evaluation">
<h1>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this heading"></a></h1>
<p>Determining whether Python has run successfully from a a scientific point of view depends very specifically on one’s goals. Did the spectra turn out to be what one expected? Here by evaluation we mean, did my run complete without significant errors and did the ionization structure converge to a “steady state” given the number of ionization cycles, the number of photons, and the frequency distributions of the photons we chose.</p>
<section id="convergence">
<h2>Convergence<a class="headerlink" href="#convergence" title="Permalink to this heading"></a></h2>
<p><a class="reference internal" href="../operation/ionization_cycles.html"><span class="doc">Ionization cycles</span></a> in Python are intended to establish the correct ion densities and temperature of the various cells in the wind.  The degree to which this happens for a given number of ionization cycles depends on how far the initial guess of electrons temperatures in various portions of the wind and the number of photons generated during each photoionization cycles.  Furthermore, the accuracy of the final model depends on the number of photons that pass through each cell.  As a result, the accuracy with which ion abundances and temperature are determined  will differ on a cell by cell basis. In a typical model with a biconical outflow, a small cells at the outer edge of the accretion disk will record fewer photon passages than one in the middle of the grid that is exposed to large numbers of photons from the disk.</p>
<p>A very basic question about a particular run is, has it reached a “steady state” and if it is in a steady state are cells stable in the sense that fluctuations are small. Hopefully, each ionization cycle brings one closer and closer to to a solution after which the ionization structure no longer evolves. Of course, since Python is a Monte Carlo code,  the degree to which the solution stays constant from cycle to cycle is limited by counting statistics.  To check convergence in Python, we monitor the the radiation temperature <span class="math notranslate nohighlight">\(T_r\)</span>, the electron temperature <span class="math notranslate nohighlight">\(T_e\)</span>, and the total heating <span class="math notranslate nohighlight">\(\mathrm{Heat_{tot}}\)</span> and cooling <span class="math notranslate nohighlight">\(\mathrm{Cooling_{tot}}\)</span> in each cell as a function of the ionization cycle <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p>To estimate whether a a model calculation has reached a steady state, Python carries out three tests, one comparing the difference in the radiation temperature between the current and the preceding ionization cycle, one comparing the electron temperature in the same manner and once comparing heating and cooling rates in the current cycle. If a cell satisfies the following 3 tests,</p>
<div class="math notranslate nohighlight">
\[\left | \frac{T_e^n-T_e^{n-1}}{T_e^n+T_e^{n-1}} \right | &lt; \epsilon\]</div>
<div class="math notranslate nohighlight">
\[\left | \frac{T_r^n-T_r^{n-1}}{T_r^n+T_r^{n-1}} \right | &lt; \epsilon\]</div>
<div class="math notranslate nohighlight">
\[\left |
\frac{\mathrm{Heat_{tot}}^n- \mathrm{Cooling_{tot}}^{n}}
{\mathrm{Heat_{tot}}^n + \mathrm{Cooling_{tot}}^{n}}
\right | &lt;\epsilon\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon = 0.05\)</span>, it is flagged as converged.</p>
<p>It is rare that all of the cells in a model will satisfy all of these criteria.  That is is because the number photons passing that pass through a cell vary considerably and the statistical  noise depends on the the number of photons. It is important to note that the photons that contribute most to the spectra of an object will be those which have the most photons passing through them.  Typically, we consider a model to be well converged if 90% of the cells are converged by this criterion.</p>
<p>The routine <code class="docutils literal notranslate"><span class="pre">run_check.py</span></code> (see <a class="reference internal" href="../py_progs.html"><span class="doc">Python Script documentation</span></a>) produces two plots related to convergence, one showing the fraction of cells that have passed each of the tests above as a function of cycle, and the other showing the number of failed checks for each cell in the wind.</p>
<p>Note that it is not always important that all cells be converged. The Monte Carlo process preferentially picks out the cells which affect the emergent radiation field. Portions of the grid which do not get many photons are typically the ones that are “not converged”, but since they don’t contribute much to the emergent radiation, one does not need them to be converged (except if one wants to make nice plots of the temperature as a function of position in the wind or of the density of a particular ion species). On the other hand, if one is using Python in conjunction with a hydrodynamical code one wants all the cells to be converged.</p>
</section>
<section id="errors">
<h2>Errors<a class="headerlink" href="#errors" title="Permalink to this heading"></a></h2>
<p>Python is designed to continue to run unless something catastrophic happens.
As it runs, it logs error messages that can be found in the .diag files.
These messages are a combinations of warnings, and/or unusual occurrences,
that if they start occurring often suggest a real problem.</p>
<p>These error messages are all of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">wind2d</span><span class="p">:</span> <span class="n">Cell</span>   <span class="mi">0</span> <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="n">domain</span> <span class="mi">0</span> <span class="n">has</span> <span class="mi">1</span> <span class="n">corners</span> <span class="ow">in</span> <span class="n">wind</span><span class="p">,</span> <span class="n">but</span> <span class="n">zero</span> <span class="n">volume</span>
</pre></div>
</div>
<p>that is they begin with the word <code class="code docutils literal notranslate"><span class="pre">Error</span></code>. followed by the subroutine in the code where the error occurred followed by what is hopefully a helpful.
If one is concerned about a particular message, one can hopefully determine what is happening by looking for that message in the log files.</p>
<p>Python keeps a count of the number of times a particular message has occurred and at the end of the program, and the very end of the
diag files contain a listing of how many times a particular error has occurred.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">summary</span><span class="p">:</span> <span class="n">End</span> <span class="n">of</span> <span class="n">program</span><span class="p">,</span> <span class="n">Thread</span> <span class="mi">2</span> <span class="n">only</span>
<span class="n">Recurrences</span> <span class="o">--</span>  <span class="n">Description</span>
     <span class="mi">7</span> <span class="o">--</span> <span class="n">getatomic_data</span><span class="p">:</span> <span class="n">line</span> <span class="nb">input</span> <span class="n">incomplete</span><span class="p">:</span> <span class="o">%</span><span class="n">s</span>
   <span class="mi">128</span> <span class="o">--</span> <span class="n">get_atomicdata</span><span class="p">:</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">interpret</span> <span class="n">line</span> <span class="o">%</span><span class="n">d</span> <span class="ow">in</span> <span class="n">file</span> <span class="o">%</span><span class="n">s</span><span class="p">:</span> <span class="o">%</span><span class="n">s</span>
     <span class="mi">1</span> <span class="o">--</span> <span class="n">error_count</span><span class="p">:</span> <span class="n">This</span> <span class="n">error</span> <span class="n">will</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">be</span> <span class="n">logged</span><span class="p">:</span> <span class="o">%</span><span class="n">s</span>
     <span class="mi">1</span> <span class="o">--</span> <span class="n">get_wind_params</span><span class="p">:</span> <span class="n">zdom</span><span class="p">[</span><span class="n">ndom</span><span class="p">]</span><span class="o">.</span><span class="n">rmax</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">wind</span> <span class="nb">type</span> <span class="o">%</span><span class="n">d</span>
     <span class="mi">1</span> <span class="o">--</span> <span class="n">wind2d</span><span class="p">:</span> <span class="n">Cell</span> <span class="o">%</span><span class="mi">3</span><span class="n">d</span> <span class="p">(</span><span class="o">%</span><span class="mi">2</span><span class="n">d</span><span class="p">,</span><span class="o">%</span><span class="mi">2</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">domain</span> <span class="o">%</span><span class="n">d</span> <span class="n">has</span> <span class="o">%</span><span class="n">d</span> <span class="n">corners</span> <span class="ow">in</span> <span class="n">wind</span><span class="p">,</span> <span class="n">but</span> <span class="n">zero</span> <span class="n">volume</span>
     <span class="mi">1</span> <span class="o">--</span> <span class="n">check_grid</span><span class="p">:</span> <span class="n">velocity</span> <span class="n">changes</span> <span class="n">by</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">,</span><span class="mi">000</span> <span class="n">km</span><span class="o">/</span><span class="n">s</span> <span class="ow">in</span> <span class="o">%</span><span class="n">i</span> <span class="n">cells</span>
     <span class="mi">1</span> <span class="o">--</span> <span class="n">check_grid</span><span class="p">:</span> <span class="n">some</span> <span class="n">cells</span> <span class="n">have</span> <span class="n">large</span> <span class="n">changes</span><span class="o">.</span> <span class="n">Consider</span> <span class="n">modifying</span> <span class="n">zlog_scale</span> <span class="ow">or</span> <span class="n">grid</span> <span class="n">dims</span>
</pre></div>
</div>
<p>As indicated here, these are the errors for only thread 2 of a program.
In order to get a summary of all the threads, there is a script py_error.py that be run as <code class="code docutils literal notranslate"><span class="pre">py_error.py</span> <span class="pre">rootname</span></code> from the main run directory.
Note that in many cases, the summary will be the number times an error occurred in one thread times the number of threads, but not always.</p>
<p>One should be aware of these errors, and watch out for situations where the number of errors  of a particular type is much larger than usual.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="diagnostics.html" class="btn btn-neutral float-left" title="Diagnostic files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model.html" class="btn btn-neutral float-right" title="Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2023, Knox Long, Christian Knigge, Stuart Sim, Nick Higginbottom, James Matthews, Sam Mangham, Edward Parkinson, Mandy Hewitt.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>